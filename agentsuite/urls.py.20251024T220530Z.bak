"""
CHANGE LOG
----------
2025-10-24
- FIX: Guard optional monorepo include `apps.api.urls` to prevent ModuleNotFoundError on PA.  # CHANGED:
- FIX: Map PostPress AI to legacy router directly: include("postpress_ai.routes_legacy", ...). # CHANGED:
- KEEP: All other routes unchanged.                                                             # CHANGED:
"""

from django.contrib import admin
from django.urls import path, include
from webdoctor import views
from barista_assistant.views import success_view

app_name = 'webdoctor'

urlpatterns = [
    # Admin
    path("admin/", admin.site.urls),

    # Webdoctor + tools
    path("agent/", include("webdoctor.urls")),
    path("webdoctor/", views.webdoctor_home, name="webdoctor_home"),
    path("tools/", include("promptopilot.urls")),

    # Website Analyzer
    path("website-analyzer/", include("website_analyzer.urls")),

    # Barista Assistant + API
    path("barista-assistant/", include("barista_assistant.urls")),
    path("api/", include("barista_assistant.api_urls")),
    path("api/menu/", include("barista_assistant.menu.urls")),
    path("success/", success_view, name="stripe-success"),

    # Content Strategy
    path("content-strategy/", include("content_strategy_generator_agent.urls")),

    # Personal Mentor
    path("personal-mentor/", include("personal_mentor.urls", namespace="personal_mentor")),

    # Debug views
    path("debug_conversation/", views.debug_conversation, name="debug_conversation"),
    path("reset_conversation/", views.reset_conversation, name="reset_conversation"),

    # === PostPress AI (legacy routes are authoritative right now) ==================
    # Wayne indicated the canonical URLConf lives in routes_legacy.py.
    # If/when postpress_ai/urls.py re-exports legacy routes, we can switch back.
    path("postpress-ai/", include("postpress_ai.routes_legacy", namespace="postpress_ai")),  # CHANGED:

    # Additional app routes
    path("api/therapylib/", include("therapylib.urls")),
    path("humancapital/", include("humancapital.urls", namespace="humancapital")),
]

# === Optional/Monorepo routes (guarded) ============================================
# Some environments may not have the 'apps' package checked out. Only include if present.
try:  # CHANGED:
    import importlib  # CHANGED:
    importlib.import_module("apps.api.urls")  # CHANGED:
except ModuleNotFoundError:  # CHANGED:
    import sys  # CHANGED:
    sys.stderr.write("[urls] Optional 'apps.api.urls' not present; skipping /reclaimr/ route\n")  # CHANGED:
else:  # CHANGED:
    urlpatterns.append(path("reclaimr/", include("apps.api.urls")))  # CHANGED:

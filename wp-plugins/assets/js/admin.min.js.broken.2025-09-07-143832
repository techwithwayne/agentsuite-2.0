(()=>{var c=window.PPA||{},g=c.ajax_url||c.ajaxUrl||(typeof ajaxurl!="undefined"?ajaxurl:"/wp-admin/admin-ajax.php"),D=c.nonce||"",X=!!c.debug,f=(e,t)=>(t||document).querySelector(e),C=(e,t)=>Array.from((t||document).querySelectorAll(e));function x(...e){X&&window.console&&console.log("[PPA]",...e)}function p(...e){window.console&&console.warn("[PPA]",...e)}function y(){if(D)return D;let e=f("#ppa-nonce");return e?String(e.value||""):""}function N(e){let t=String(e||"").replace(/^\/+/,"");if(c.assets_url)return c.assets_url.replace(/\/+$/,"/")+t;if(c.pluginUrl)return c.pluginUrl.replace(/\/+$/,"/")+t;if(c.plugin_url)return c.plugin_url.replace(/\/+$/,"/")+t;let i="/wp-content/plugins/postpress-ai/";try{let r=document.currentScript&&document.currentScript.src;if(r&&r.includes(i)){let n=new URL(r,window.location.origin);return(n.origin+n.pathname.slice(0,n.pathname.indexOf(i)+i.length)).replace(/\/+$/,"/")+t}}catch{}try{let r=document.getElementsByTagName("script");for(let n=r.length-1;n>=0;n--){let a=r[n].src||"";if(a&&a.includes(i)){let o=new URL(a,window.location.origin);return(o.origin+o.pathname.slice(0,o.pathname.indexOf(i)+i.length)).replace(/\/+$/,"/")+t}}}catch{}try{return window.location.origin.replace(/\/+$/,"")+i+t}catch{return i+t}}function S(e){if(!e)return{};let t=Object.create(null);function i(r,n){t[r]===void 0?t[r]=n:Array.isArray(t[r])?t[r].push(n):t[r]=[t[r],n]}try{if(typeof FormData!="undefined"&&e instanceof FormData){for(let r of e.entries()){let n=r[0],a=r[1],o=n.match(/^fields\[(.+)\]$/);i(o?o[1]:n,String(a))}return t}}catch{}try{if(typeof URLSearchParams!="undefined"&&e instanceof URLSearchParams){for(let[r,n]of e.entries()){let a=r.match(/^fields\[(.+)\]$/);i(a?a[1]:r,String(n))}return t}}catch{}if(typeof e=="object"){for(let r of Object.keys(e)){let n=e[r];Array.isArray(n)?t[r]=n.map(a=>a==null?"":String(a)):n==null?t[r]="":t[r]=String(n)}return t}return{}}function $(e,t={}){if(!e||typeof e.append!="function")return;for(let n of Object.keys(t)){let a=t[n];if(Array.isArray(a))for(let o of a)e.append(`fields[${n}]`,o==null?"":String(o));else e.append(`fields[${n}]`,a==null?"":String(a))}let i=new Set;try{for(let n of e.entries())i.add(n[0])}catch{}for(let n of Object.keys(t)){if(i.has(n))continue;let a=t[n];if(Array.isArray(a))for(let o of a)try{e.append(String(n),o==null?"":String(o))}catch{}else try{e.append(String(n),a==null?"":String(a))}catch{}}let r=i.has("title");if(!r&&"title"in t&&t.title!==void 0&&t.title!==null&&String(t.title)!==""){try{e.append("title",String(t.title))}catch{}r=!0}if(!r){let n=t.subject||t.headline||null;if(n!=null&&String(n)!=="")try{e.append("title",Array.isArray(n)?String(n[0]):String(n))}catch{}}}async function h(e,t={}){let i=y();if(!i)throw new Error("Missing nonce");let r=new FormData;r.append("action",e),r.append("nonce",i),t.mode&&r.append("mode",String(t.mode)),$(r,t.fields||{});let n=await fetch(g,{method:"POST",credentials:"same-origin",body:r,headers:{"X-Requested-With":"XMLHttpRequest"}}),a=await n.text().catch(()=>""),o;try{let s=a.trim();s===""?o="":o=JSON.parse(s)}catch{o=a}if(!n.ok){let s=typeof o=="object"?JSON.stringify(o).slice(0,280):String(o).slice(0,280);throw new Error(`HTTP ${n.status}: ${s}`)}return o}function m(){let e=["#ppa-preview-window","#ppa-preview-pane",".ppa-preview-pane","#ppa-preview",".ppa-preview"];for(let t of e){let i=f(t);if(i)return i}return null}function K(e){if(!e)return"";if(typeof e=="string")return e;let t=(n,a)=>{try{return a.split(".").reduce((o,s)=>o&&o[s]!=null?o[s]:void 0,n)}catch{return}},i=["result.html","result.content","result.body","data.html","html","wp_body","body","payload.output.html","output.html","content.rendered","rendered","markup","preview_html"];for(let n of i){let a=t(e,n);if(typeof a=="string"&&a.trim())return a}if(e.result&&typeof e.result=="object"){for(let n of Object.values(e.result))if(typeof n=="string"&&/<\/(p|div|h\d|article|section)>/i.test(n))return n}let r=t(e,"message")||t(e,"error")||t(e,"result.message");return typeof r=="string"&&r.trim()?`<p><em>${r}</em></p>`:""}function E(e){let t=m();if(!t){p("Preview pane not found");return}let i=K(e);t.innerHTML=i&&i.trim()?i:"<p><em>No preview HTML returned.</em></p>"}function O(){let e=m();if(!e)return null;let t=e.querySelector(".ppa-preloader");if(!t){t=document.createElement("div"),t.className="ppa-preloader",t.setAttribute("aria-hidden","true");let i=document.createElement("div");i.className="ppa-lds-spinner";for(let n=0;n<12;n++)i.appendChild(document.createElement("div"));let r=document.createElement("div");r.className="ppa-preloader-label",r.textContent="Generating preview\u2026",t.appendChild(i),t.appendChild(r),e.appendChild(t)}return t}function b(e){if(!m())return;let i=O();if(!i)return;let r=i.querySelector(".ppa-preloader-label");r||(r=document.createElement("div"),r.className="ppa-preloader-label",i.appendChild(r)),r.textContent=String(e||"").trim()||"Working\u2026"}function L(e){let t=m();t&&(O(),e&&b(e),t.classList.add("ppa-is-loading"),t.setAttribute("aria-busy","true"))}function P(){let e=m();e&&(e.classList.remove("ppa-is-loading"),e.removeAttribute("aria-busy"))}var z="#121212",V="#ff6c00";function Q(e,t,i){e.open(),e.write(`<!doctype html>
<html lang="en"><head><meta charset="utf-8">
<title>PostPress AI \u2014 ${t?String(t):"Working\u2026"}</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root { --bg:${z}; --accent:${V}; --text:#f2f2f2; --muted:#bcbcbc; }
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;display:grid;place-items:center}
.wrap{max-width:720px;padding:24px;text-align:center}
h1{margin:0 0 8px;font-size:22px;letter-spacing:.2px}
p{margin:8px 0 0;color:var(--muted)}
.ring{position:relative;width:58px;height:58px;margin:20px auto 14px;border-radius:50%;
border:3px solid rgba(255,255,255,.12);border-top-color:var(--accent);border-right-color:#ff8a33;animation:spin .8s linear infinite;box-shadow:0 0 0 2px rgba(0,0,0,.18) inset}
.dots::after{content:".";animation:dots 1.2s steps(3,end) infinite}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes dots{0%{content:"."}33%{content:".."}66%{content:"..."}100%{content:"."}}
.brand{display:inline-block;margin-top:6px;font-weight:700;color:#ffb27a}
</style></head>
<body><div class="wrap">
<div class="ring" aria-hidden="true"></div>
<h1 id="ppa-status">${t?String(t):"Working"}<span class="dots"></span></h1>
<p id="ppa-sub">${i?String(i):"Please keep this tab open \u2014 we will take you to the WordPress editor as soon as your post is ready."}</p>
<div class="brand">PostPress&nbsp;AI</div>
</div></body></html>`),e.close()}function U(){let e=null;try{e=window.open("about:blank","_blank"),e&&e.document&&Q(e.document,"Preparing","Initializing\u2026")}catch{}return e}function w(e,t,i){if(!(!e||e.closed))try{let r=e.document,n=r.getElementById("ppa-status"),a=r.getElementById("ppa-sub");if(n&&t&&(n.textContent=String(t)),a&&i&&(a.textContent=String(i)),n){let o=r.createElement("span");o.className="dots",n.appendChild(o)}}catch{}}async function I(e){e&&e.preventDefault&&e.preventDefault(),L("Generating preview\u2026");try{let t=S(),i=await h("ppa_preview",{fields:t});E(i)}catch(t){p("Preview error",t),b("Something went wrong \u2014 see console.")}finally{P()}}async function _(e,t){t&&t.preventDefault&&t.preventDefault();let i=U();L("Generating preview\u2026");try{let r=S(),n=Object.assign({},r,{quality:"final",mode:e});try{w(i,"Generating preview","Asking AI for final content\u2026");let s=await h("ppa_preview",{fields:n});E(s);let d=s&&s.result||{};n=Object.assign({},n,{title:d.title||n.title||r.title||r.subject||"",html:d.html||n.html||r.html||"",summary:d.summary||n.summary||r.summary||""})}catch(s){x("Final-quality preview failed; continuing to store.",s)}b("Saving draft\u2026"),w(i,"Saving draft","Creating your post in WordPress\u2026");let a=await h("ppa_store",{mode:e,fields:n}),o=a&&(a.edit_url||a.edit_url_note)||"";if(!o)try{let s=a&&a.result&&a.result.id,d=((window==null?void 0:window.ajaxurl)||g||"").replace(/\/admin-ajax\.php$/,"/post.php");s&&d&&(o=`${d}?post=${encodeURIComponent(s)}&action=edit`)}catch{}if(o){b("Opening editor\u2026"),w(i,"Opening editor","Redirecting to the WordPress post editor\u2026");try{i&&!i.closed?(i.location.replace(o),i.focus()):window.open(o,"_blank","noopener")}catch{window.open(o,"_blank","noopener")}}else x("Store completed without edit_url.")}catch(r){p("Store error",r),b("Something went wrong \u2014 see console.")}finally{P()}}var Y=["ppa-tone","ppa-audience","ppa-keywords"],Z=180,l=null,ee={tone:["Friendly","Professional","Persuasive","Technical","Casual","Storytelling","Inspirational","Luxury","Minimalist","Playful","Serious","Conversational","Educational","Authoritative"],audience:["Small Business Owners","Entrepreneurs","Students","Iowa Residents","Marketers","Developers","Designers","Executives","Local Community","Ecommerce Owners","Parents","Nonprofits"],keywords:["WordPress","SEO","Content Marketing","AI","Iowa Web Design","Small Business Growth","Luxury Branding","Website Redesign","Conversion Optimization","Social Media Strategy","Email Marketing","Page Speed"]};async function te(){if(l)return l;try{let e=N("assets/data/autocomplete.json"),t=await fetch(e,{credentials:"same-origin"});if(!t.ok)throw new Error(`HTTP ${t.status}`);if(l=await t.json(),!l||typeof l!="object")throw new Error("Bad JSON payload")}catch(e){p("Autocomplete data load failed, using defaults.",e),l=ee}return l}function u(e){let t=e&&e.nextElementSibling;return t&&t.classList&&t.classList.contains("ppa-autocomplete-list")?t:e&&e.parentElement?e.parentElement.querySelector(".ppa-autocomplete-list"):null}function A(e){return Array.from(e?e.querySelectorAll("li"):[])}function M(e){e&&(e.setAttribute("role","combobox"),e.setAttribute("aria-autocomplete","list"),e.setAttribute("aria-haspopup","listbox"),e.hasAttribute("aria-expanded")||e.setAttribute("aria-expanded","false"))}function q(e,t){if(!e)return;if(!t){e.setAttribute("aria-expanded","false"),e.removeAttribute("aria-activedescendant"),e.removeAttribute("aria-controls");return}t.id||(t.id="ppa-ac-"+(e.id||Math.random().toString(36).slice(2))),e.setAttribute("aria-controls",t.id),e.setAttribute("aria-expanded","true");let i=A(t);i.forEach((r,n)=>{r.id||(r.id=`${t.id}-opt-${n}`),r.getAttribute("aria-selected")==="true"&&e.setAttribute("aria-activedescendant",r.id)}),!e.getAttribute("aria-activedescendant")&&i[0]&&e.setAttribute("aria-activedescendant",i[0].id)}function B(e){let t=u(e);if(!t)return;let i=t.querySelector('li[aria-selected="true"]');i&&i.id&&e.setAttribute("aria-activedescendant",i.id)}function W(e,t){let i=u(e);return i?(A(i).forEach((n,a)=>{if(a===t){n.setAttribute("aria-selected","true");try{n.scrollIntoView({block:"nearest"})}catch{}}else n.removeAttribute("aria-selected")}),e.setAttribute("data-ppa-ac-index",String(t)),B(e),t):-1}function H(e){let t=u(e);if(!t)return;let i=t.querySelector('[aria-selected="true"]'),r=parseInt(e.getAttribute("data-ppa-ac-index")||"-1",10);!i&&(isNaN(r)||r<0)&&A(t).length&&W(e,0)}function j(e,t){let i=u(e);if(!i)return;let r=A(i);if(!r.length)return;let n=parseInt(e.getAttribute("data-ppa-ac-index")||"-1",10);isNaN(n)&&(n=-1),n+=t,n<0&&(n=r.length-1),n>=r.length&&(n=0),W(e,n)}function R(e){let t=u(e);if(!t)return!1;let i=t.querySelector('li[aria-selected="true"]')||t.querySelector("li");if(!i)return!1;e.value=(i.textContent||"").trim();try{t.remove()}catch{}e.setAttribute("aria-expanded","false"),e.removeAttribute("aria-activedescendant");try{e.dispatchEvent(new Event("change",{bubbles:!0}))}catch{}return e.removeAttribute("data-ppa-ac-index"),!0}function v(e){let t=u(e);t&&t.parentNode&&t.parentNode.removeChild(t),e.removeAttribute("data-ppa-ac-index"),e.setAttribute("aria-expanded","false"),e.removeAttribute("aria-activedescendant")}function re(){document.querySelectorAll(".ppa-autocomplete-list").forEach(e=>e.remove())}function ne(e,t){if(re(),!l||!l[t])return;let i=String(e.value||"").trim().toLowerCase();if(!i)return;let r=l[t].filter(a=>a.toLowerCase().includes(i)).slice(0,8);if(!r.length)return;let n=document.createElement("ul");n.className="ppa-autocomplete-list",n.setAttribute("role","listbox"),r.forEach(a=>{let o=document.createElement("li");o.textContent=a,o.setAttribute("role","option"),o.addEventListener("mousedown",s=>{s.preventDefault(),e.value=a,v(e)}),n.appendChild(o)}),e.insertAdjacentElement("afterend",n),H(e),q(e,n)}function F(e){return!(e==="ArrowDown"||e==="ArrowUp"||e==="Enter"||e==="Escape"||e==="Tab"||e==="Debounced")}function ie(e){try{let t=new KeyboardEvent("keyup",{key:"Debounced",bubbles:!0,cancelable:!0});e.dispatchEvent(t)}catch{let i=document.createEvent("Event");i.initEvent("keyup",!0,!0),i.key="Debounced",e.dispatchEvent(i)}}function G(){Y.forEach(e=>{let t=document.getElementById(e);t&&(t.setAttribute("autocomplete","off"),M(t),t._ppaDebTimer=null,t.addEventListener("keydown",i=>{let r=i.key;r==="ArrowDown"?(i.preventDefault(),j(t,1)):r==="ArrowUp"?(i.preventDefault(),j(t,-1)):r==="Enter"?R(t)&&(i.preventDefault(),i.stopPropagation()):r==="Tab"?u(t)&&R(t)&&(i.preventDefault(),i.stopPropagation()):r==="Escape"&&v(t)}),t.addEventListener("keyup",i=>{let r=i.key;if(!F(r))return;i.stopPropagation(),t._ppaDebTimer&&(clearTimeout(t._ppaDebTimer),t._ppaDebTimer=null);let n=t.nextElementSibling;if(n&&n.classList&&n.classList.contains("ppa-autocomplete-list"))try{n.remove()}catch{}t._ppaDebTimer=setTimeout(()=>{t._ppaDebTimer=null,ie(t)},Z)},!0),t.addEventListener("keyup",async i=>{let r=i.key;if(r==="Escape"){v(t);return}F(r)&&r!=="Debounced"||(await te(),ne(t,e.replace("ppa-","")))}),t.addEventListener("input",()=>{t.setAttribute("data-ppa-ac-index","-1")}),t.addEventListener("blur",()=>setTimeout(()=>v(t),120)),t.addEventListener("focus",()=>setTimeout(()=>H(t),0)))});try{new MutationObserver(t=>{t.forEach(i=>{Array.prototype.forEach.call(i.addedNodes||[],r=>{if(r instanceof HTMLElement&&r.classList&&r.classList.contains("ppa-autocomplete-list")){let n=r.previousElementSibling&&r.previousElementSibling.tagName==="INPUT"?r.previousElementSibling:r.parentElement&&r.parentElement.querySelector("input");n&&(M(n),q(n,r),B(n))}})})}).observe(document.body,{childList:!0,subtree:!0})}catch{}}function J(){C(".ppa-form select").forEach(e=>{if(!e.parentElement.classList.contains("ppa-select-wrap")){let t=document.createElement("div");t.className="ppa-select-wrap",e.parentNode.insertBefore(t,e),t.appendChild(e)}})}function k(e){let t=f(`[data-ppa-action="${e}"]`);if(t)return t;let i={preview:["#ppa-preview-btn","#ppa-btn-preview"],draft:["#ppa-save-btn","#ppa-btn-draft"],publish:["#ppa-publish-btn","#ppa-btn-publish"]};for(let r of i[e]||[]){let n=f(r);if(n)return n}return null}function T(){y()||p("PPA nonce missing; admin-ajax calls may fail.");let e=k("preview"),t=k("draft"),i=k("publish");e&&e.addEventListener("click",I,!1),t&&t.addEventListener("click",_.bind(null,"draft"),!1),i&&i.addEventListener("click",_.bind(null,"publish"),!1),G(),J()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",T,{once:!0}):T();})();
//# sourceMappingURL=admin.min.js.map
/* PPA v5 preview injector (idempotent) */
;(()=>{if(window.__PPA_TAP_V5__)return;window.__PPA_TAP_V5__=!0;function e(){var e=document.querySelector(".ppa-generated-preview")||document.querySelector("#ppa-preview-html")||document.querySelector("#ppa_preview_html");if(!e){var n=document.querySelector("#wpbody-content")||document.body;e=document.createElement("div"),e.className="ppa-generated-preview";var t=document.createElement("h1");t.textContent="Preview",e.appendChild(t),n.appendChild(e)}return e.hidden=!1,e.style.display="",e.classList&&e.classList.remove("hidden","is-hidden"),e}function n(n){var t=e(),o=n&&"string"==typeof n&&n.trim()?n:"<p><em>No preview HTML returned.</em></p>",r=t.querySelector("h1");if(r){for(;r.nextSibling;)r.nextSibling.remove();var i=document.createElement("div");i.className="ppa-preview-body",i.innerHTML=o,r.insertAdjacentElement("afterend",i)}else t.innerHTML=o}function t(e){try{var n=JSON.parse(e);if(n&&"object"==typeof n&&"success"in n)return n.success&&n.data?n.data.html||"":"";if(n&&"object"==typeof n&&n.ok&&n.result)return n.result.html||"";if(n&&"object"==typeof n)return n.html||""}catch(e){}return e}try{if(window.fetch){var o=window.fetch;window.fetch=function(e,r){try{var i="string"==typeof e?e:e&&e.url||"",a=r||{},s=String(a.method||"GET").toUpperCase(),d=a.body,u=/admin-ajax\.php/i.test(i),l=u&&"POST"===s&&(d instanceof FormData&&"ppa_preview"===(d.get("action")||"")||"string"==typeof d&&/(^|&)action=ppa_preview(&|$)/.test(d)||d&&d.toString===URLSearchParams.prototype.toString&&/(^|&)action=ppa_preview(&|$)/.test(d.toString())),c=o.apply(this,arguments);return l&&c.then((function(e){return e.clone().text().then((function(e){console.log("[PPA v5][fetch] len=",e.length);try{n(t(e))}catch(e){}}))})).catch((function(){})),c}catch(e){return o.apply(this,arguments)}}}if(window.XMLHttpRequest){var r=XMLHttpRequest.prototype.open,i=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(e,n){return this.__ppa_isAjax=/admin-ajax\.php/i.test(String(n||"")),this.__ppa_m=(e||"GET").toUpperCase(),r.apply(this,arguments)},XMLHttpRequest.prototype.send=function(e){var r=this.__ppa_isAjax&&"POST"===this.__ppa_m&&(e instanceof FormData&&"ppa_preview"===(e.get("action")||"")||"string"==typeof e&&/(^|&)action=ppa_preview(&|$)/.test(e));return r&&this.addEventListener("loadend",(function(){try{var e=this&&(this.responseText||"")||"";console.log("[PPA v5][xhr] len=",e.length),n(t(e))}catch(e){}})),i.apply(this,arguments)}}catch(e){window.console&&console.warn&&console.warn("PPA v5 injector error",e)}})();

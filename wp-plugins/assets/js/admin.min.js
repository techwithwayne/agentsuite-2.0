(()=>{var p=window.PPA||{},g=p.ajax_url||p.ajaxUrl||(typeof ajaxurl<"u"?ajaxurl:"/wp-admin/admin-ajax.php"),N=p.nonce||"",z=!!p.debug,c=(e,t)=>(t||document).querySelector(e),w=(e,t)=>Array.from((t||document).querySelectorAll(e));function E(...e){z&&window.console&&console.log("[PPA]",...e)}function u(...e){window.console&&console.warn("[PPA]",...e)}function h(){if(N)return N;let e=c("#ppa-nonce");return e?String(e.value||""):""}function $(e){let t=String(e||"").replace(/^\/+/,"");if(p.assets_url)return p.assets_url.replace(/\/+$/,"/")+t;if(p.pluginUrl)return p.pluginUrl.replace(/\/+$/,"/")+t;if(p.plugin_url)return p.plugin_url.replace(/\/+$/,"/")+t;let n="/wp-content/plugins/postpress-ai/";try{let r=document.currentScript&&document.currentScript.src;if(r&&r.includes(n)){let a=new URL(r,window.location.origin);return(a.origin+a.pathname.slice(0,a.pathname.indexOf(n)+n.length)).replace(/\/+$/,"/")+t}}catch{}try{let r=document.getElementsByTagName("script");for(let a=r.length-1;a>=0;a--){let o=r[a].src||"";if(o&&o.includes(n)){let i=new URL(o,window.location.origin);return(i.origin+i.pathname.slice(0,i.pathname.indexOf(n)+n.length)).replace(/\/+$/,"/")+t}}}catch{}try{return window.location.origin.replace(/\/+$/,"")+n+t}catch{return n+t}}function K(){return c("#ppa-composer")||c(".ppa-composer")||c("#ppa-composer-form")||document}function _(){let e=K(),t={},n=(a,o)=>{if(o==null)return;let i=String(o).trim();i!==""&&(t[a]=i)},r={subject:["#ppa-subject","#ppa_subject",'[name="subject"]','[name="ppa_subject"]'],genre:["#ppa-genre","#ppa_genre",'[name="genre"]','[name="ppa_genre"]'],tone:["#ppa-tone","#ppa_tone",'[name="tone"]','[name="ppa_tone"]'],title:["#ppa-title",'[name="title"]','[name="post_title"]','[name="ppa_title"]'],keywords:["#ppa-keywords",'[name="keywords"]','[name="ppa_keywords"]'],audience:["#ppa-audience",'[name="audience"]','[name="target_audience"]','[name="ppa_audience"]'],length:["#ppa-length",'[name="length"]','[name="ppa_length"]'],cta:["#ppa-cta",'[name="cta"]','[name="call_to_action"]','[name="ppa_cta"]'],summary:["#ppa-summary",'[name="summary"]','[name="ppa_summary"]'],description:["#ppa-description",'[name="description"]','[name="ppa_description"]'],excerpt:["#ppa-excerpt",'[name="excerpt"]','[name="post_excerpt"]','[name="ppa_excerpt"]'],slug:["#ppa-slug",'[name="slug"]','[name="post_name"]','[name="ppa_slug"]'],content:["#ppa-content",'[name="content"]','[name="post_content"]','[name="ppa_content"]']};for(let[a,o]of Object.entries(r))for(let i of o){let s=c(i,e);if(!s)continue;if(a==="content")try{if(window.tinymce&&tinymce.get&&s.id&&tinymce.get(s.id)){let D=tinymce.get(s.id);n("content",D.getContent({format:"html"}));break}}catch{}let d=(s.value!=null?String(s.value):s.textContent)||"";n(a,d);break}return w("[data-field]",e).forEach(a=>{let o=String(a.getAttribute("data-field")||"").trim();if(!o||t[o])return;let i=(a.value!=null?String(a.value):a.textContent)||"";n(o,i)}),t.subject&&!t.title&&(t.title=t.subject),t.title&&!t.subject&&(t.subject=t.title),t}function O(e,t){!t||typeof t!="object"||Object.keys(t).forEach(n=>{let r=t[n];r!=null&&e.append(`fields[${n}]`,String(r))})}async function v(e,t={}){let n=h();if(!n)throw new Error("Missing nonce");let r=new FormData;r.append("action",e),r.append("nonce",n),t.mode&&r.append("mode",String(t.mode)),O(r,t.fields||{});let a=await fetch(g,{method:"POST",credentials:"same-origin",body:r,headers:{"X-Requested-With":"XMLHttpRequest"}}),o;try{o=await a.json()}catch{let s=await a.text().catch(()=>"");throw new Error(`Bad JSON (${a.status}): ${s.slice(0,280)}`)}if(!a.ok)throw new Error(`HTTP ${a.status}: ${JSON.stringify(o).slice(0,280)}`);return o}function f(){let e=["#ppa-preview-window","#ppa-preview-pane",".ppa-preview-pane","#ppa-preview",".ppa-preview"];for(let t of e){let n=c(t);if(n)return n}return null}function V(e){if(!e)return"";if(typeof e=="string")return e;let t=(a,o)=>{try{return o.split(".").reduce((i,s)=>i&&i[s]!=null?i[s]:void 0,a)}catch{return}},n=["result.html","result.content","result.body","data.html","html","wp_body","body","payload.output.html","output.html","content.rendered","rendered","markup","preview_html"];for(let a of n){let o=t(e,a);if(typeof o=="string"&&o.trim())return o}if(e.result&&typeof e.result=="object"){for(let a of Object.values(e.result))if(typeof a=="string"&&/<\/(p|div|h\d|article|section)>/i.test(a))return a}let r=t(e,"message")||t(e,"error")||t(e,"result.message");return typeof r=="string"&&r.trim()?`<p><em>${r}</em></p>`:""}function S(e){let t=f();if(!t){u("Preview pane not found");return}let n=V(e);t.innerHTML=n&&n.trim()?n:"<p><em>No preview HTML returned.</em></p>"}function j(){let e=f();if(!e)return null;let t=e.querySelector(".ppa-preloader");if(!t){t=document.createElement("div"),t.className="ppa-preloader",t.setAttribute("aria-hidden","true");let n=document.createElement("div");n.className="ppa-lds-spinner";for(let a=0;a<12;a++)n.appendChild(document.createElement("div"));let r=document.createElement("div");r.className="ppa-preloader-label",r.textContent="Generating preview\u2026",t.appendChild(n),t.appendChild(r),e.appendChild(t)}return t}function b(e){if(!f())return;let n=j();if(!n)return;let r=n.querySelector(".ppa-preloader-label");r||(r=document.createElement("div"),r.className="ppa-preloader-label",n.appendChild(r)),r.textContent=String(e||"").trim()||"Working\u2026"}function L(e){let t=f();t&&(j(),e&&b(e),t.classList.add("ppa-is-loading"),t.setAttribute("aria-busy","true"))}function P(){let e=f();e&&(e.classList.remove("ppa-is-loading"),e.removeAttribute("aria-busy"))}var Q="#121212",Y="#ff6c00";function Z(e,t,n){e.open(),e.write(`<!doctype html>
<html lang="en"><head><meta charset="utf-8">
<title>PostPress AI \u2014 ${t?String(t):"Working\u2026"}</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root { --bg:${Q}; --accent:${Y}; --text:#f2f2f2; --muted:#bcbcbc; }
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;display:grid;place-items:center}
.wrap{max-width:720px;padding:24px;text-align:center}
h1{margin:0 0 8px;font-size:22px;letter-spacing:.2px}
p{margin:8px 0 0;color:var(--muted)}
.ring{position:relative;width:58px;height:58px;margin:20px auto 14px;border-radius:50%;
border:3px solid rgba(255,255,255,.12);border-top-color:var(--accent);border-right-color:#ff8a33;animation:spin .8s linear infinite;box-shadow:0 0 0 2px rgba(0,0,0,.18) inset}
.dots::after{content:".";animation:dots 1.2s steps(3,end) infinite}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes dots{0%{content:"."}33%{content:".."}66%{content:"..."}100%{content:"."}}
.brand{display:inline-block;margin-top:6px;font-weight:700;color:#ffb27a}
</style></head>
<body><div class="wrap">
<div class="ring" aria-hidden="true"></div>
<h1 id="ppa-status">${t?String(t):"Working"}<span class="dots"></span></h1>
<p id="ppa-sub">${n?String(n):"Please keep this tab open \u2014 we will take you to the WordPress editor as soon as your post is ready."}</p>
<div class="brand">PostPress&nbsp;AI</div>
</div></body></html>`),e.close()}function I(){let e=null;try{e=window.open("about:blank","_blank"),e&&e.document&&Z(e.document,"Preparing","Initializing\u2026")}catch{}return e}function y(e,t,n){if(!(!e||e.closed))try{let r=e.document,a=r.getElementById("ppa-status"),o=r.getElementById("ppa-sub");if(a&&t&&(a.textContent=String(t)),o&&n&&(o.textContent=String(n)),a){let i=r.createElement("span");i.className="dots",a.appendChild(i)}}catch{}}async function U(e){e&&e.preventDefault&&e.preventDefault(),L("Generating preview\u2026");try{let t=_(),n=await v("ppa_preview",{fields:t});S(n)}catch(t){u("Preview error",t),b("Something went wrong \u2014 see console.")}finally{P()}}async function k(e,t){t&&t.preventDefault&&t.preventDefault();let n=I();L("Generating preview\u2026");try{let r=_(),a=Object.assign({},r,{quality:"final",mode:e});try{y(n,"Generating preview","Asking AI for final content\u2026");let s=await v("ppa_preview",{fields:a});S(s);let d=s&&s.result||{};a=Object.assign({},a,{title:d.title||a.title||r.title||r.subject||"",html:d.html||a.html||r.html||"",summary:d.summary||a.summary||r.summary||""})}catch(s){E("Final-quality preview failed; continuing to store.",s)}b("Saving draft\u2026"),y(n,"Saving draft","Creating your post in WordPress\u2026");let o=await v("ppa_store",{mode:e,fields:a}),i=o&&(o.edit_url||o.edit_url_note)||"";if(!i)try{let s=o&&o.result&&o.result.id,d=(window?.ajaxurl||g||"").replace(/\/admin-ajax\.php$/,"/post.php");s&&d&&(i=`${d}?post=${encodeURIComponent(s)}&action=edit`)}catch{}if(i){b("Opening editor\u2026"),y(n,"Opening editor","Redirecting to the WordPress post editor\u2026");try{n&&!n.closed?(n.location.replace(i),n.focus()):window.open(i,"_blank","noopener")}catch{window.open(i,"_blank","noopener")}}else E("Store completed without edit_url.")}catch(r){u("Store error",r),b("Something went wrong \u2014 see console.")}finally{P()}}var ee=["ppa-tone","ppa-audience","ppa-keywords"],te=180,l=null,ne={tone:["Friendly","Professional","Persuasive","Technical","Casual","Storytelling","Inspirational","Luxury","Minimalist","Playful","Serious","Conversational","Educational","Authoritative"],audience:["Small Business Owners","Entrepreneurs","Students","Iowa Residents","Marketers","Developers","Designers","Executives","Local Community","Ecommerce Owners","Parents","Nonprofits"],keywords:["WordPress","SEO","Content Marketing","AI","Iowa Web Design","Small Business Growth","Luxury Branding","Website Redesign","Conversion Optimization","Social Media Strategy","Email Marketing","Page Speed"]};async function re(){if(l)return l;try{let e=$("assets/data/autocomplete.json"),t=await fetch(e,{credentials:"same-origin"});if(!t.ok)throw new Error(`HTTP ${t.status}`);if(l=await t.json(),!l||typeof l!="object")throw new Error("Bad JSON payload")}catch(e){u("Autocomplete data load failed, using defaults.",e),l=ne}return l}function m(e){let t=e&&e.nextElementSibling;return t&&t.classList&&t.classList.contains("ppa-autocomplete-list")?t:e&&e.parentElement?e.parentElement.querySelector(".ppa-autocomplete-list"):null}function A(e){return Array.from(e?e.querySelectorAll("li"):[])}function M(e){e&&(e.setAttribute("role","combobox"),e.setAttribute("aria-autocomplete","list"),e.setAttribute("aria-haspopup","listbox"),e.hasAttribute("aria-expanded")||e.setAttribute("aria-expanded","false"))}function q(e,t){if(!e)return;if(!t){e.setAttribute("aria-expanded","false"),e.removeAttribute("aria-activedescendant"),e.removeAttribute("aria-controls");return}t.id||(t.id="ppa-ac-"+(e.id||Math.random().toString(36).slice(2))),e.setAttribute("aria-controls",t.id),e.setAttribute("aria-expanded","true");let n=A(t);n.forEach((r,a)=>{r.id||(r.id=`${t.id}-opt-${a}`),r.getAttribute("aria-selected")==="true"&&e.setAttribute("aria-activedescendant",r.id)}),!e.getAttribute("aria-activedescendant")&&n[0]&&e.setAttribute("aria-activedescendant",n[0].id)}function W(e){let t=m(e);if(!t)return;let n=t.querySelector('li[aria-selected="true"]');n&&n.id&&e.setAttribute("aria-activedescendant",n.id)}function H(e,t){let n=m(e);return n?(A(n).forEach((a,o)=>{if(o===t){a.setAttribute("aria-selected","true");try{a.scrollIntoView({block:"nearest"})}catch{}}else a.removeAttribute("aria-selected")}),e.setAttribute("data-ppa-ac-index",String(t)),W(e),t):-1}function G(e){let t=m(e);if(!t)return;let n=t.querySelector('[aria-selected="true"]'),r=parseInt(e.getAttribute("data-ppa-ac-index")||"-1",10);!n&&(isNaN(r)||r<0)&&A(t).length&&H(e,0)}function R(e,t){let n=m(e);if(!n)return;let r=A(n);if(!r.length)return;let a=parseInt(e.getAttribute("data-ppa-ac-index")||"-1",10);isNaN(a)&&(a=-1),a+=t,a<0&&(a=r.length-1),a>=r.length&&(a=0),H(e,a)}function B(e){let t=m(e);if(!t)return!1;let n=t.querySelector('li[aria-selected="true"]')||t.querySelector("li");if(!n)return!1;e.value=(n.textContent||"").trim();try{t.remove()}catch{}e.setAttribute("aria-expanded","false"),e.removeAttribute("aria-activedescendant");try{e.dispatchEvent(new Event("change",{bubbles:!0}))}catch{}return e.removeAttribute("data-ppa-ac-index"),!0}function x(e){let t=m(e);t&&t.parentNode&&t.parentNode.removeChild(t),e.removeAttribute("data-ppa-ac-index"),e.setAttribute("aria-expanded","false"),e.removeAttribute("aria-activedescendant")}function ae(){document.querySelectorAll(".ppa-autocomplete-list").forEach(e=>e.remove())}function oe(e,t){if(ae(),!l||!l[t])return;let n=String(e.value||"").trim().toLowerCase();if(!n)return;let r=l[t].filter(o=>o.toLowerCase().includes(n)).slice(0,8);if(!r.length)return;let a=document.createElement("ul");a.className="ppa-autocomplete-list",a.setAttribute("role","listbox"),r.forEach(o=>{let i=document.createElement("li");i.textContent=o,i.setAttribute("role","option"),i.addEventListener("mousedown",s=>{s.preventDefault(),e.value=o,x(e)}),a.appendChild(i)}),e.insertAdjacentElement("afterend",a),G(e),q(e,a)}function F(e){return!(e==="ArrowDown"||e==="ArrowUp"||e==="Enter"||e==="Escape"||e==="Tab"||e==="Debounced")}function ie(e){try{let t=new KeyboardEvent("keyup",{key:"Debounced",bubbles:!0,cancelable:!0});e.dispatchEvent(t)}catch{let n=document.createEvent("Event");n.initEvent("keyup",!0,!0),n.key="Debounced",e.dispatchEvent(n)}}function J(){ee.forEach(e=>{let t=document.getElementById(e);t&&(t.setAttribute("autocomplete","off"),M(t),t._ppaDebTimer=null,t.addEventListener("keydown",n=>{let r=n.key;r==="ArrowDown"?(n.preventDefault(),R(t,1)):r==="ArrowUp"?(n.preventDefault(),R(t,-1)):r==="Enter"?B(t)&&(n.preventDefault(),n.stopPropagation()):r==="Tab"?m(t)&&B(t)&&(n.preventDefault(),n.stopPropagation()):r==="Escape"&&x(t)}),t.addEventListener("keyup",n=>{let r=n.key;if(!F(r))return;n.stopPropagation(),t._ppaDebTimer&&(clearTimeout(t._ppaDebTimer),t._ppaDebTimer=null);let a=t.nextElementSibling;if(a&&a.classList&&a.classList.contains("ppa-autocomplete-list"))try{a.remove()}catch{}t._ppaDebTimer=setTimeout(()=>{t._ppaDebTimer=null,ie(t)},te)},!0),t.addEventListener("keyup",async n=>{let r=n.key;if(r==="Escape"){x(t);return}F(r)&&r!=="Debounced"||(await re(),oe(t,e.replace("ppa-","")))}),t.addEventListener("input",()=>{t.setAttribute("data-ppa-ac-index","-1")}),t.addEventListener("blur",()=>setTimeout(()=>x(t),120)),t.addEventListener("focus",()=>setTimeout(()=>G(t),0)))});try{new MutationObserver(t=>{t.forEach(n=>{Array.prototype.forEach.call(n.addedNodes||[],r=>{if(r instanceof HTMLElement&&r.classList&&r.classList.contains("ppa-autocomplete-list")){let a=r.previousElementSibling&&r.previousElementSibling.tagName==="INPUT"?r.previousElementSibling:r.parentElement&&r.parentElement.querySelector("input");a&&(M(a),q(a,r),W(a))}})})}).observe(document.body,{childList:!0,subtree:!0})}catch{}}function X(){w(".ppa-form select").forEach(e=>{if(!e.parentElement.classList.contains("ppa-select-wrap")){let t=document.createElement("div");t.className="ppa-select-wrap",e.parentNode.insertBefore(t,e),t.appendChild(e)}})}function T(e){let t=c(`[data-ppa-action="${e}"]`);if(t)return t;let n={preview:["#ppa-preview-btn","#ppa-btn-preview"],draft:["#ppa-save-btn","#ppa-btn-draft"],publish:["#ppa-publish-btn","#ppa-btn-publish"]};for(let r of n[e]||[]){let a=c(r);if(a)return a}return null}function C(){h()||u("PPA nonce missing; admin-ajax calls may fail.");let e=T("preview"),t=T("draft"),n=T("publish");e&&e.addEventListener("click",U,!1),t&&t.addEventListener("click",k.bind(null,"draft"),!1),n&&n.addEventListener("click",k.bind(null,"publish"),!1),J(),X()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",C,{once:!0}):C();})();
//# sourceMappingURL=admin.min.js.map

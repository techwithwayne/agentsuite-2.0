# /home/techwithwayne/agentsuite/postpress_ai/views/__init__.py
"""
PostPress AI — views package initializer (compat shim)

CHANGE LOG
----------
2025-10-25 • Add explicit package-level exports for all expected view names,
             and alias `store` to the normalize-only `store_view`.           # CHANGED:
- Exposes: health, version, preview, preview_debug_model, store               # CHANGED:
- Uses safe imports with fallbacks so URLConf imports won't break             # CHANGED:
"""

from __future__ import annotations

from typing import Callable
from django.http import JsonResponse, HttpRequest, HttpResponse

# --- Safe import helpers -------------------------------------------------------
def _fallback(name: str) -> Callable[[HttpRequest], HttpResponse]:
    """
    Minimal fallback view so URL imports don't explode if a module is missing.
    Returns 501 to signal 'not implemented' rather than throwing at import-time.
    """
    def _view(_req: HttpRequest) -> HttpResponse:
        return JsonResponse(
            {"ok": False, "error": f"view-missing:{name}", "ver": "1"},
            status=501,
        )
    _view.__name__ = name
    return _view


# health
try:
    from .health import health_view as health  # type: ignore
except Exception:
    health = _fallback("health")

# version
try:
    from .version import version_view as version  # type: ignore
except Exception:
    version = _fallback("version")

# preview
try:
    from .preview import preview_view as preview  # type: ignore
except Exception:
    preview = _fallback("preview")

# preview_debug_model
try:
    from .preview_debug_model import preview_debug_model_view as preview_debug_model  # type: ignore
except Exception:
    preview_debug_model = _fallback("preview_debug_model")

# store (normalize-only)
try:
    from .store import store_view as store  # CHANGED: alias legacy `store` to normalize-only handler
except Exception:
    store = _fallback("store")

__all__ = ["health", "version", "preview", "preview_debug_model", "store"]
